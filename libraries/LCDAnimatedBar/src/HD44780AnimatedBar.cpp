#include <Arduino.h>
#include "HD44780AnimatedBar.h"

static hd44780_I2Cexp* HD44780AnimatedBar::lcd = NULL;

static const uint8_t HD44780AnimatedBar::charBarrowsBitmap[][8] = {
	{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1f}, // char 0 
	{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1f, 0x1f}, // char 1
	{0x00, 0x00, 0x00, 0x00, 0x00, 0x1f, 0x1f, 0x1f}, // char 2
	{0x00, 0x00, 0x00, 0x00, 0x1f, 0x1f, 0x1f, 0x1f}, // char 3
	{0x00, 0x00, 0x00, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f}, // char 4
	{0x00, 0x00, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f}, // char 5
	{0x00, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f}, // char 6
	{0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f}, // char 7
};
                                         
static const uint8_t HD44780AnimatedBar::charBarNeedlesBitmap[][8] = {
	{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1f}, // char 0 
	{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1f, 0x1f}, // char 1
	{0x00, 0x00, 0x00, 0x00, 0x00, 0x1f, 0x1f, 0x1f}, // char 2
	{0x00, 0x00, 0x00, 0x00, 0x1f, 0x1f, 0x1f, 0x1f}, // char 3
	{0x00, 0x00, 0x00, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f}, // char 4
	{0x00, 0x00, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f}, // char 5
	{0x00, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f}, // char 6
	{0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f}, // char 7
};

static const uint8_t HD44780AnimatedBar::charBarBubblesBitmap[][8] = {
	{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1f}, // char 0 
	{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1f, 0x1f}, // char 1
	{0x00, 0x00, 0x00, 0x00, 0x00, 0x1f, 0x1f, 0x1f}, // char 2
	{0x00, 0x00, 0x00, 0x00, 0x1f, 0x1f, 0x1f, 0x1f}, // char 3
	{0x00, 0x00, 0x00, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f}, // char 4
	{0x00, 0x00, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f}, // char 5
	{0x00, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f}, // char 6
	{0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f}, // char 7
};

static const uint8_t HD44780AnimatedBar::charBarMoreBubblesBitmap[][8] = {
	{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1f}, // char 0 
	{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1f, 0x1f}, // char 1
	{0x00, 0x00, 0x00, 0x00, 0x00, 0x1f, 0x1f, 0x1f}, // char 2
	{0x00, 0x00, 0x00, 0x00, 0x1f, 0x1f, 0x1f, 0x1f}, // char 3
	{0x00, 0x00, 0x00, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f}, // char 4
	{0x00, 0x00, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f}, // char 5
	{0x00, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f}, // char 6
	{0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f}, // char 7
};


HD44780AnimatedBar::HD44780AnimatedBar(
    uint8_t col = 0, 
    uint8_t row = 0, 
    uint8_t value = 0, 
    uint8_t start_value = 0, 
    uint8_t end_value = 7) : 
    LCDAnimatedBar(col, row, value, start_value, end_value) {
};

static void HD44780AnimatedBar::createChars(HD44780AnimatedBar::bar_type_t barType) {
  for ( int i = 0; i < LCDAnimatedBar::charBitmapSize; i++ ) {
    switch(barType) {
      case HD44780AnimatedBar::BAR_rowS:        lcd->createChar ( i, (uint8_t *)charBarrowsBitmap[i] ); break;
      case HD44780AnimatedBar::BAR_NEEDELS:      lcd->createChar ( i, (uint8_t *)charBarNeedlesBitmap[i] ); break;
      case HD44780AnimatedBar::BAR_BUBBLES:      lcd->createChar ( i, (uint8_t *)charBarBubblesBitmap[i] ); break;
      case HD44780AnimatedBar::BAR_MORE_BUBBLES: lcd->createChar ( i, (uint8_t *)charBarMoreBubblesBitmap[i] ); break;
      default:                                   lcd->createChar ( i, (uint8_t *)charBarrowsBitmap[i] );
    };
  };
	lcd->setCursor(0,0);
}

void HD44780AnimatedBar::displayBarOnLcd(uint8_t col, uint8_t row, uint8_t value) {
  HD44780AnimatedBar::lcd->setCursor(col, row);
  HD44780AnimatedBar::lcd->write(char(value));
};

static void HD44780AnimatedBar::init( 	hd44780_I2Cexp& llcd, 
										HD44780AnimatedBar::bar_type_t barType = BAR_rowS) {
	HD44780AnimatedBar::lcd = &llcd;
	HD44780AnimatedBar::createChars(barType);
	HD44780AnimatedBar::setCallback(displayBarOnLcd);
};
